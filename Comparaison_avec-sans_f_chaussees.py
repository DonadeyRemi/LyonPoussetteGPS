# -*- coding: utf-8 -*-
"""
Created on Mon Apr 17 22:56:33 2023

@author: timhu
"""
# Resultats :
# 105 nouvelles clés trouvées dans le fichier chaussées qui ne sont pas 
#  dans le fichier tronçons

# note : la plupart des troncons trouvés, et peut etre meme tous
#            ne sont pas visible sur le site datagrandlyon

# resultats détaillés à la fin de ce code

import json

def charger_donnees(arrondi_gps=12):
    f_troncons_geojson = r"C:\Users\timhu\Documents\1_Scolaire\INSA_2A\Informatique\Projet\Donnees_projet\Troncons_trame_viaire.geojson"
    f_chausses_geojson = r"C:\Users\timhu\Documents\1_Scolaire\INSA_2A\Informatique\Projet\Donnees_projet\Chaussees_et_trottoirs.geojson"
    #f_troncons_geojson = "troncon_trame_viaire.geojson"
    #f_chausses_geojson = "chaussees_trotoirs.geojson"
   
    with open(f_troncons_geojson,encoding='utf-8') as fichier :
        data = json.load(fichier)
    dico_noeuds = {}
    for segment in data["features"]:
        co_gps_rue = list(segment["geometry"]["coordinates"])
        rue = segment["properties"]["codefuv"]
        troncon = segment["properties"]["codetroncon"]
        for i in range(len(co_gps_rue)):
            co_gps_rue[i][0] = round(co_gps_rue[i][0],arrondi_gps)
            co_gps_rue[i][1] = round(co_gps_rue[i][1],arrondi_gps)
        
        for co_gps in co_gps_rue:
            tuple_gps = (co_gps[0],co_gps[1])
            if tuple_gps not in dico_noeuds.keys():
                dico_noeuds[tuple_gps]={}
            if rue not in dico_noeuds[tuple_gps].keys():
                dico_noeuds[tuple_gps][rue]=[]
            if troncon not in dico_noeuds[tuple_gps][rue]:
                dico_noeuds[tuple_gps][rue].append(troncon)
                
    dico_noeuds_2 = dico_noeuds
    a_supprimer = []
    for tuple_gps in dico_noeuds_2:
        if len(dico_noeuds_2[tuple_gps]) < 2:
            for rue in dico_noeuds_2[tuple_gps]:
                if len(dico_noeuds_2[tuple_gps][rue]) < 2:
                    a_supprimer.append(tuple_gps)
    for tuple_gps in a_supprimer:
        dico_noeuds_2.pop(tuple_gps)
        
    rues_adj_gps_2 = {}
    for noeud in dico_noeuds_2:
        liste_adj = []
        for rue in dico_noeuds_2[noeud]:
            for troncon in dico_noeuds_2[noeud][rue]:
                liste_adj.append((rue,troncon))
        for (rue,troncon) in liste_adj:
            if (rue,troncon) not in rues_adj_gps_2.keys() :
                if len(liste_adj) == 1 :
                    rues_adj_gps_2[(rue,troncon)] = []
                else:
                    rues_adj_gps_2[(rue,troncon)] = []
                    for i in liste_adj :
                        if i != (rue,troncon) and i not in rues_adj_gps_2[(rue,troncon)] :
                            rues_adj_gps_2[(rue,troncon)].append(i)
            else:
                for i in liste_adj :
                    if i != (rue,troncon) and i not in rues_adj_gps_2[(rue,troncon)]:
                        rues_adj_gps_2[(rue,troncon)].append(i)
                
    with open(f_chausses_geojson,encoding='utf-8') as fichier :
        data = json.load(fichier)
    for segment in data["features"]:
        proprietes = segment["properties"]
        troncon = proprietes["codetroncon"]
        rue = proprietes["codefuv"]
        co_gps_rue = list(segment["geometry"]["coordinates"])
        for i in range(len(co_gps_rue)):
            co_gps_rue[i][0] = round(co_gps_rue[i][0],arrondi_gps)
            co_gps_rue[i][1] = round(co_gps_rue[i][1],arrondi_gps)        
        
        for co_gps in co_gps_rue:
            tuple_gps = (co_gps[0],co_gps[1])
            if tuple_gps not in dico_noeuds.keys():
                dico_noeuds[tuple_gps]={}
            if rue not in dico_noeuds[tuple_gps].keys():
                dico_noeuds[tuple_gps][rue]=[]
            if troncon not in dico_noeuds[tuple_gps][rue]:
                dico_noeuds[tuple_gps][rue].append(troncon)
        
    a_supprimer = []
    for tuple_gps in dico_noeuds:
        if len(dico_noeuds[tuple_gps]) < 2:
            for rue in dico_noeuds[tuple_gps]:
                if len(dico_noeuds[tuple_gps][rue]) < 2:
                    a_supprimer.append(tuple_gps)
    for tuple_gps in a_supprimer:
        dico_noeuds.pop(tuple_gps)

    rues_adj_gps = {}
    for noeud in dico_noeuds:
        liste_adj = []
        for rue in dico_noeuds[noeud]:
            for troncon in dico_noeuds[noeud][rue]:
                liste_adj.append((rue,troncon))
        for (rue,troncon) in liste_adj:
            if (rue,troncon) not in rues_adj_gps.keys() :
                if len(liste_adj) == 1 :
                    rues_adj_gps[(rue,troncon)] = []
                else:
                    rues_adj_gps[(rue,troncon)] = []
                    for i in liste_adj :
                        if i != (rue,troncon) and i not in rues_adj_gps[(rue,troncon)] :
                            rues_adj_gps[(rue,troncon)].append(i)
            else:
                for i in liste_adj :
                    if i != (rue,troncon) and i not in rues_adj_gps[(rue,troncon)]:
                        rues_adj_gps[(rue,troncon)].append(i)

    print(len(rues_adj_gps))
    print(len(rues_adj_gps_2))
    
    cherche_diff(rues_adj_gps,rues_adj_gps_2)

def cherche_diff(rues_adj_1, rues_adj_2):
    cles_diff = []
    for (rue,troncon) in rues_adj_1:
        if (rue, troncon) not in rues_adj_2.keys():
            cles_diff.append((rue, troncon))
    for (rue, troncon) in cles_diff:
        print((rue, troncon)," --->", rues_adj_1[(rue, troncon)])
    print(len(cles_diff))      

    
charger_donnees()

# Resultats détaillés :

# ('28850', 'T49550')  ---> [('28712', 'T39228'), ('28712', 'T24591'), ('28712', 'T39229'), ('28712', 'T24555'), ('28847', 'T24377'), ('28715', 'T24530'), ('28715', 'T24535'), ('20500', 'T24534'), ('20242', 'T47761'), ('20242', 'T47762')]
# ('28629', 'T1440')  ---> [('28667', 'T4980'), ('28667', 'T54622'), ('28629', 'T4847'), ('31946', 'T229')]
# ('20291', 'T22256')  ---> [('20381', 'T30665'), ('20381', 'T22261'), ('20291', 'T17627'), ('20291', 'T17637'), ('20489', 'T54577')]
# ('23568', 'T46413')  ---> [('23452', 'T8654'), ('23452', 'T8596'), ('23538', 'T17172'), ('35296', 'T38296'), ('35296', 'T40895')]
# ('37172', 'T35009')  ---> [('37172', 'T1858'), ('34424', 'T45275'), ('37172', 'T45322')]
# ('37172', 'T45322')  ---> [('37172', 'T35009'), ('34711', 'T45321')]
# ('23534', 'T22307')  ---> [('23463', 'T43715'), ('23463', 'T43712'), ('23534', 'T43708'), ('23534', 'T43709')]
# ('27534', 'T1674')  ---> [('27534', 'T1668'), ('27534', 'T53037'), ('27570', 'T1669'), ('27534', 'T1839'), ('27534', 'T53039')]
# ('27388', 'T49114')  ---> [('27459', 'T1121'), ('27388', 'T49115'), ('27369', 'T27128')]
# ('27388', 'T49115')  ---> [('27388', 'T49114'), ('27369', 'T27128'), ('27388', 'T38040'), ('35343', 'T38041')]
# ('27369', 'T27128')  ---> [('27388', 'T49114'), ('27388', 'T49115'), ('27369', 'T27129')]
# ('30507', 'T20220')  ---> [('19943', 'T44570'), ('30507', 'T21521')]
# ('02789', 'T27917')  ---> [('33828', 'T27920'), ('33828', 'T45829'), ('02789', 'T27918'), ('02789', 'T20211'), ('02806', 'T27603')]
# ('27404', 'T53075')  ---> [('27293', 'T24845'), ('27416', 'T1135'), ('27416', 'T4945'), ('27398', 'T4679'), ('27272', 'T24859'), ('37188', 'T53077'), ('27404', 'T53076')]
# ('14902', 'T13085')  ---> [('14902', 'T9249'), ('14902', 'T54287'), ('14901', 'T13086'), ('14731', 'T19927'), ('14894', 'T13724'), ('14894', 'T13087'), ('14764', 'T11813')]
# ('14902', 'T54287')  ---> [('14902', 'T9249'), ('14902', 'T13085'), ('14901', 'T13086'), ('14731', 'T19927'), ('14894', 'T13724'), ('14894', 'T13087'), ('14764', 'T11813')]
# ('32758', 'T34973')  ---> [('32758', 'T54562'), ('32758', 'T54556'), ('32756', 'T10188'), ('32758', 'T34974'), ('34708', 'T34975')]
# ('21185', 'T48349')  ---> [('21185', 'T48350'), ('19727', 'T38927'), ('19727', 'T46932'), ('19735', 'T25295')]
# ('36679', 'T16963')  ---> [('36680', 'T16962'), ('36685', 'T29971'), ('20471', 'T48875'), ('20471', 'T18312'), ('36681', 'T17374')]
# ('21424', 'T363')  ---> [('21410', 'T25407'), ('21410', 'T25404'), ('21576', 'T25408'), ('21576', 'T25405')]
# ('36653', 'T25406')  ---> [('21410', 'T25407'), ('36653', 'T426'), ('30640', 'T417')]
# ('23753', 'T47345')  ---> [('32907', 'T10202'), ('32907', 'T10201'), ('23753', 'T47346')]
# ('28480', 'T2311')  ---> [('28480', 'T2257'), ('30235', 'T2303'), ('28639', 'T2258'), ('28480', 'T2297'), ('28659', 'T2296'), ('28505', 'T24319')]
# ('30235', 'T2303')  ---> [('28480', 'T2311'), ('28480', 'T2257'), ('28639', 'T2258'), ('30235', 'T2304'), ('28598', 'T2308')]
# ('28505', 'T24319')  ---> [('28480', 'T2311'), ('28480', 'T2297'), ('28659', 'T2296')]
# ('32979', 'T46048')  ---> [('32979', 'T46049'), ('32979', 'T33937')]
# ('22416', 'T52703')  ---> [('22527', 'T31197'), ('22527', 'T52702'), ('22416', 'T22014'), ('22416', 'T46840'), ('22600', 'T20728')]
# ('25882', 'T7145')  ---> [('33140', 'T47850'), ('25882', 'T40762'), ('33139', 'T22531'), ('36703', 'T53794'), ('25882', 'T22137')]
# ('20011', 'T25301')  ---> [('21437', 'T30105'), ('19762', 'T10561')]
# ('21437', 'T30105')  ---> [('20011', 'T25301'), ('21437', 'T48205'), ('21437', 'T34149')]
# ('19762', 'T10561')  ---> [('20011', 'T25301')]
# ('26115', 'T52510')  ---> [('26115', 'T23001'), ('26115', 'T52509'), ('26115', 'T40620'), ('26115', 'T41426'), ('26115', 'T52506'), ('31168', 'T23130'), ('26115', 'T52511'), ('26115', 'T52512')]
# ('20291', 'T17637')  ---> [('20234', 'T29932'), ('20234', 'T8820'), ('20248', 'T8847'), ('20248', 'T54575'), ('20291', 'T22256'), ('20489', 'T54577')]
# ('20489', 'T54577')  ---> [('20291', 'T17637'), ('20291', 'T22256'), ('20489', 'T54578'), ('20489', 'T54576')]
# ('28868', 'T34966')  ---> [('28868', 'T3750'), ('28827', 'T3772'), ('28872', 'T3789'), ('28872', 'T36191'), ('28868', 'T3756')]
# ('20225', 'T26503')  ---> [('20256', 'T13213'), ('20225', 'T53603'), ('20256', 'T19600')]
# ('20032', 'T50357')  ---> [('20032', 'T50355'), ('20032', 'T50354'), ('20032', 'T50356'), ('35779', 'T46901')]
# ('20032', 'T50356')  ---> [('20032', 'T50357'), ('35779', 'T46901'), ('20032', 'T48912'), ('35780', 'T48921')]
# ('35779', 'T46901')  ---> [('20032', 'T50357'), ('20032', 'T50356'), ('35779', 'T48919')]
# ('28559', 'T4866')  ---> [('28480', 'T2312'), ('28480', 'T2297'), ('28559', 'T49855'), ('28559', 'T2306'), ('28598', 'T2308')]
# ('11678', 'T12774')  ---> [('11635', 'T23651'), ('11635', 'T20931'), ('11678', 'T12481'), ('11714', 'T12195')]
# ('26219', 'T9047')  ---> [('26219', 'T22152'), ('25886', 'T26586'), ('26219', 'T50587'), ('32476', 'T26215')]
# ('28348', 'T49579')  ---> [('28348', 'T49577'), ('28348', 'T49578')]
# ('22940', 'T17452')  ---> [('23018', 'T8520'), ('22940', 'T22384')]
# ('22940', 'T22384')  ---> [('23018', 'T8520'), ('22940', 'T17452'), ('22945', 'T8544'), ('22945', 'T17573')]
# ('25880', 'T26421')  ---> [('36073', 'T14205'), ('36073', 'T23959'), ('25880', 'T26415'), ('36703', 'T53795')]
# ('25882', 'T22137')  ---> [('36073', 'T14205'), ('36073', 'T14829'), ('36703', 'T53794'), ('25882', 'T7145')]
# ('20019', 'T19353')  ---> [('20019', 'T19844'), ('19715', 'T10147'), ('19989', 'T9767'), ('19989', 'T12689'), ('20019', 'T50325')]
# ('32979', 'T33937')  ---> [('31618', 'T33938'), ('34479', 'T33939'), ('32979', 'T46048')]
# ('22938', 'T17597')  ---> [('22938', 'T19385'), ('32948', 'T18576'), ('32950', 'T17529'), ('22938', 'T17641')]
# ('07293', 'T48601')  ---> [('07293', 'T48602'), ('07259', 'T48605'), ('32451', 'T26024'), ('07295', 'T6354'), ('07298', 'T601')]
# ('32799', 'T17372')  ---> [('32799', 'T17277'), ('32799', 'T17364')]
# ('32799', 'T17277')  ---> [('32799', 'T17372'), ('32799', 'T17364'), ('22939', 'T22312'), ('22939', 'T35881')]
# ('32799', 'T17364')  ---> [('32799', 'T17372'), ('32799', 'T17277')]
# ('02955', 'T12421')  ---> [('02943', 'T15263'), ('02955', 'T12422'), ('02962', 'T53657'), ('33828', 'T27915'), ('33828', 'T45832'), ('02955', 'T6623')]
# ('34956', 'T36279')  ---> [('23153', 'T36277'), ('23153', 'T36278'), ('23054', 'T36276'), ('23054', 'T36275')]
# ('02952', 'T6503')  ---> [('02952', 'T27926'), ('02952', 'T52059'), ('02779', 'T6642'), ('30651', 'T8101'), ('02959', 'T6497'), ('02952', 'T39148'), ('02918', 'T6495')]
# ('02952', 'T39148')  ---> [('02952', 'T6503'), ('02918', 'T6495'), ('02952', 'T39149'), ('02952', 'T52059'), ('02950', 'T45988')]
# ('34623', 'T44338')  ---> [('34623', 'T44339'), ('34623', 'T51879'), ('34623', 'T43193')]
# ('28295', 'T48606')  ---> [('29203', 'T18349'), ('28332', 'T48609'), ('28295', 'T48610'), ('28295', 'T48607')]
# ('22781', 'T17528')  ---> [('32950', 'T12169'), ('32950', 'T17529'), ('22781', 'T17640'), ('22781', 'T17526')]
# ('35405', 'T38433')  ---> [('24725', 'T23332'), ('35405', 'T19242'), ('24715', 'T38432'), ('35405', 'T40878')]
# ('27404', 'T53076')  ---> [('37188', 'T53077'), ('27404', 'T53075'), ('27404', 'T1335'), ('27262', 'T24840')]
# ('02789', 'T20211')  ---> [('02789', 'T27917'), ('02806', 'T27603'), ('02776', 'T50278'), ('02776', 'T50275')]
# ('02806', 'T27603')  ---> [('02789', 'T27917'), ('02789', 'T20211')]
# ('29179', 'T16403')  ---> [('29179', 'T53764'), ('29179', 'T14939'), ('29144', 'T2809'), ('29179', 'T16015')]
# ('29179', 'T14939')  ---> [('29179', 'T53764'), ('29179', 'T16403'), ('29111', 'T4787'), ('29144', 'T16180')]
# ('27668', 'T24752')  ---> [('27668', 'T49298'), ('28714', 'T49303'), ('28714', 'T49306'), ('28716', 'T24516'), ('27970', 'T70'), ('27668', 'T49308')]
# ('28598', 'T2308')  ---> [('30235', 'T2303'), ('30235', 'T2304'), ('28559', 'T4866'), ('28559', 'T2306')]
# ('22939', 'T22312')  ---> [('23002', 'T18176'), ('23002', 'T8545'), ('22939', 'T19037'), ('22939', 'T35881'), ('32799', 'T17277')]
# ('36653', 'T426')  ---> [('36653', 'T25406'), ('30640', 'T417'), ('21576', 'T25409'), ('36654', 'T418')]
# ('22939', 'T35881')  ---> [('22939', 'T22312'), ('32799', 'T17277'), ('34894', 'T35883'), ('22939', 'T35882')]
# ('32758', 'T54557')  ---> [('23712', 'T14439'), ('23738', 'T10176'), ('23738', 'T10938'), ('32758', 'T54558'), ('32758', 'T54556')]
# ('23129', 'T16155')  ---> [('23079', 'T23688'), ('23129', 'T14573'), ('23129', 'T45445'), ('23129', 'T11209')]
# ('34965', 'T36630')  ---> [('34997', 'T36444'), ('34997', 'T36445'), ('35035', 'T36628'), ('34965', 'T36631'), ('37058', 'T51688'), ('35023', 'T36430')]
# ('22527', 'T52701')  ---> [('31869', 'T42024'), ('36078', 'T23765'), ('22527', 'T52702'), ('36283', 'T44846')]
# ('34399', 'T45896')  ---> [('34396', 'T45897'), ('34399', 'T45909'), ('34399', 'T45908')]
# ('22945', 'T17573')  ---> [('22945', 'T8544'), ('22940', 'T22384'), ('22945', 'T18064')]
# ('35237', 'T49679')  ---> [('35226', 'T37027'), ('35226', 'T37845'), ('35048', 'T37028')]
# ('35201', 'T37592')  ---> [('35212', 'T47614'), ('35070', 'T37599'), ('35070', 'T37596'), ('35201', 'T43740'), ('35180', 'T43739')]
# ('28872', 'T36191')  ---> [('28872', 'T3789'), ('28868', 'T34966'), ('28868', 'T3756'), ('28872', 'T36192'), ('34943', 'T36193')]
# ('15641', 'T7883')  ---> [('15641', 'T11293'), ('15678', 'T20329'), ('15641', 'T20006'), ('30447', 'T42265')]
# ('15641', 'T20006')  ---> [('15641', 'T7883'), ('30447', 'T42265'), ('15641', 'T6081'), ('15646', 'T20548')]
# ('30447', 'T42265')  ---> [('15641', 'T7883'), ('15641', 'T20006')]
# ('33937', 'T53991')  ---> [('37256', 'T54042'), ('37256', 'T53996'), ('33937', 'T54012'), ('30210', 'T54008'), ('30210', 'T54009')]
# ('20474', 'T19025')  ---> [('20228', 'T8823'), ('20228', 'T8817'), ('36687', 'T23769'), ('20474', 'T18636'), ('33022', 'T42287')]
# ('36703', 'T53794')  ---> [('25882', 'T7145'), ('25882', 'T22137'), ('36703', 'T53796')]
# ('37058', 'T51688')  ---> [('34965', 'T36630'), ('34965', 'T36631'), ('35023', 'T36430')]
# ('36779', 'T47622')  ---> [('35236', 'T47616'), ('35236', 'T47617'), ('36779', 'T47621'), ('36524', 'T51924'), ('36779', 'T47623')]
# ('11678', 'T12481')  ---> [('11678', 'T12774'), ('11714', 'T12195'), ('11678', 'T12478'), ('11599', 'T12953')]
# ('34399', 'T45909')  ---> [('34399', 'T31263'), ('34805', 'T35501'), ('34399', 'T45896'), ('34399', 'T45908')]
# ('34399', 'T45908')  ---> [('34399', 'T45896'), ('34399', 'T45909'), ('34399', 'T31254'), ('34865', 'T31258')]
# ('30481', 'T37911')  ---> [('18772', 'T19822'), ('18772', 'T22787'), ('18649', 'T13279'), ('30481', 'T12670')]
# ('30481', 'T12670')  ---> [('18649', 'T13279'), ('30481', 'T37911'), ('30481', 'T13294'), ('18797', 'T13208')]
# ('15415', 'T46069')  ---> [('15415', 'T46068'), ('15415', 'T46067'), ('15415', 'T12086'), ('15435', 'T6925')]
# ('15415', 'T46068')  ---> [('15415', 'T46069'), ('15415', 'T46067'), ('34592', 'T33469'), ('15415', 'T33467')]
# ('15415', 'T46067')  ---> [('15415', 'T46069'), ('15415', 'T46068'), ('15415', 'T12086'), ('15435', 'T6925')]
# ('25880', 'T26415')  ---> [('25880', 'T26421'), ('36703', 'T53795'), ('25880', 'T15419'), ('30528', 'T26417')]
# ('36703', 'T53795')  ---> [('25880', 'T26421'), ('25880', 'T26415'), ('36703', 'T53796')]
# ('23129', 'T45445')  ---> [('23129', 'T45446'), ('23129', 'T45444'), ('23129', 'T11209'), ('23129', 'T16155')]
# ('23129', 'T11209')  ---> [('23129', 'T45445'), ('23129', 'T16155'), ('23061', 'T11208')]
# ('35953', 'T45130')  ---> [('35953', 'T45128'), ('35953', 'T54682'), ('35953', 'T21801'), ('06836', 'T22207')]
# ('27668', 'T49308')  ---> [('27678', 'T24746'), ('27668', 'T44473'), ('27668', 'T24752')]
# ('36687', 'T23769')  ---> [('20474', 'T19025'), ('20474', 'T18636'), ('33022', 'T42287'), ('36686', 'T16387')]
# ('32803', 'T38100')  ---> [('27812', 'T38470'), ('35359', 'T38101'), ('32864', 'T38099'), ('32803', 'T38469')]
# 105